<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Further survival analyses • CohortSurvival</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Further survival analyses">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CohortSurvival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01_Single_event_of_interest.html">Single outcome event of interest</a></li>
    <li><a class="dropdown-item" href="../articles/a02_Competing_risk_survival.html">Competing risk survival</a></li>
    <li><a class="dropdown-item" href="../articles/a03_Further_survival_analyses.html">Further survival analyses</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav"></ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Further survival analyses</h1>
            
      

      <div class="d-none name"><code>a03_Further_survival_analyses.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>Let us first load the packages required.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/CohortSurvival/" class="external-link">CohortSurvival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.R-project.org" class="external-link">cmprsk</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></code></pre></div>
<p>We will create a cdm reference to use our example MGUS2 survival
dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CohortSurvival</span><span class="fu">::</span><span class="fu"><a href="../reference/mockMGUS2cdm.html">mockMGUS2cdm</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The CohortSurvival package does not have implemented functionality to
do more complex survival analyses than Kaplar Meier curves, like Cox
Proportional Hazards modelling. However, the format the data has to be
in to be inputted to well-known modelling functions from packages like
<code>survival</code> or <code>cmprsk</code>can be retrieved from OMOP
data with some in-built functions in this package. Let us see how to do
it in both single event and competing risk survival settings.</p>
</div>
<div class="section level2">
<h2 id="further-analysis-with-single-event-survival">Further analysis with single event survival<a class="anchor" aria-label="anchor" href="#further-analysis-with-single-event-survival"></a>
</h2>
<p>To get the <code>time</code> and <code>status</code> information we
need for the <code>coxph</code> function in the package
<code>survival</code>, for instance, we only need to call
<code>addCohortSurvival</code>. The stratification variables need to be
columns previously added to the cohort by the user.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_survival_single</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">mgus_diagnosis</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="../reference/addCohortSurvival.html">addCohortSurvival</a></span><span class="op">(</span></span>
<span>       cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>       outcomeCohortTable <span class="op">=</span> <span class="st">"death_cohort"</span>,</span>
<span>       outcomeCohortId <span class="op">=</span> <span class="fl">1</span></span>
<span>       <span class="op">)</span> </span>
<span></span>
<span><span class="va">input_survival_single</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 13</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.3.0 [unknown@Linux 6.11.0-1015-azure:R 4.5.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>11<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>13<span style="color: #949494;">, </span>14<span style="color: #949494;">, </span>15<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1981-01-01<span style="color: #949494;">, </span>1968-01-01<span style="color: #949494;">, </span>1980-01-01<span style="color: #949494;">, </span>1977-01-01<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1981-01-01<span style="color: #949494;">, </span>1968-01-01<span style="color: #949494;">, </span>1980-01-01<span style="color: #949494;">, </span>1977-01-01<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ age                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 88<span style="color: #949494;">, </span>78<span style="color: #949494;">, </span>94<span style="color: #949494;">, </span>68<span style="color: #949494;">, </span>90<span style="color: #949494;">, </span>90<span style="color: #949494;">, </span>89<span style="color: #949494;">, </span>87<span style="color: #949494;">, </span>79<span style="color: #949494;">, </span>86<span style="color: #949494;">, </span>89<span style="color: #949494;">, </span>87<span style="color: #949494;">, </span>8…</span></span>
<span><span class="co">#&gt; $ sex                  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M…</span></span>
<span><span class="co">#&gt; $ hgb                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 13.1<span style="color: #949494;">, </span>11.5<span style="color: #949494;">, </span>10.5<span style="color: #949494;">, </span>15.2<span style="color: #949494;">, </span>10.7<span style="color: #949494;">, </span>12.9<span style="color: #949494;">, </span>10.5<span style="color: #949494;">, </span>12.3<span style="color: #949494;">, </span>9…</span></span>
<span><span class="co">#&gt; $ creat                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.30<span style="color: #949494;">, </span>1.20<span style="color: #949494;">, </span>1.50<span style="color: #949494;">, </span>1.20<span style="color: #949494;">, </span>0.80<span style="color: #949494;">, </span>1.00<span style="color: #949494;">, </span>0.90<span style="color: #949494;">, </span>1.20<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ mspike               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5<span style="color: #949494;">, </span>2.0<span style="color: #949494;">, </span>2.6<span style="color: #949494;">, </span>1.2<span style="color: #949494;">, </span>1.0<span style="color: #949494;">, </span>0.5<span style="color: #949494;">, </span>1.3<span style="color: #949494;">, </span>1.6<span style="color: #949494;">, </span>2.3<span style="color: #949494;">, </span>2.3<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ age_group            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&lt;70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;…</span></span>
<span><span class="co">#&gt; $ days_to_exit         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 30<span style="color: #949494;">, </span>25<span style="color: #949494;">, </span>46<span style="color: #949494;">, </span>92<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>151<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>136<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>108<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>14…</span></span>
<span><span class="co">#&gt; $ status               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ time                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 30<span style="color: #949494;">, </span>25<span style="color: #949494;">, </span>46<span style="color: #949494;">, </span>92<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>151<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>136<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>108<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>14…</span></span></code></pre></div>
<p>We can decide to change some of the default parameters in this
function. Information on all these can be found
<code><a href="../reference/addCohortSurvival.html">?addCohortSurvival</a></code>. For instance, we can choose to exclude
people with an outcome only 180 days before index date, instead of
anytime, and follow them up for only one year. We can also decide to use
<code>cohort_end_date</code> as their outcome variable and censor them
at a particular date, for instance, the 1st of January of 1994. We see
how that gives us different results:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">mgus_diagnosis</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="../reference/addCohortSurvival.html">addCohortSurvival</a></span><span class="op">(</span></span>
<span>       cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>       outcomeCohortTable <span class="op">=</span> <span class="st">"death_cohort"</span>,</span>
<span>       outcomeWashout <span class="op">=</span> <span class="fl">180</span>,</span>
<span>       followUpDays <span class="op">=</span> <span class="fl">365</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort_start_date</span> <span class="op">&gt;</span> <span class="st">"1993-01-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 13</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.3.0 [unknown@Linux 6.11.0-1015-azure:R 4.5.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 213<span style="color: #949494;">, </span>671<span style="color: #949494;">, </span>941<span style="color: #949494;">, </span>1245<span style="color: #949494;">, </span>1248<span style="color: #949494;">, </span>1340<span style="color: #949494;">, </span>1374<span style="color: #949494;">, </span>1376<span style="color: #949494;">, </span>1380…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ age                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 93<span style="color: #949494;">, </span>81<span style="color: #949494;">, </span>85<span style="color: #949494;">, </span>82<span style="color: #949494;">, </span>87<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>68<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>69<span style="color: #949494;">, </span>66<span style="color: #949494;">, </span>79<span style="color: #949494;">, </span>86<span style="color: #949494;">, </span>8…</span></span>
<span><span class="co">#&gt; $ sex                  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M…</span></span>
<span><span class="co">#&gt; $ hgb                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 12.8<span style="color: #949494;">, </span>13.0<span style="color: #949494;">, </span>13.6<span style="color: #949494;">, </span>11.4<span style="color: #949494;">, </span>12.7<span style="color: #949494;">, </span>12.2<span style="color: #949494;">, </span>9.2<span style="color: #949494;">, </span>13.7<span style="color: #949494;">, </span>15…</span></span>
<span><span class="co">#&gt; $ creat                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.1<span style="color: #949494;">, </span>1.4<span style="color: #949494;">, </span>1.1<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>1.4<span style="color: #949494;">, </span>1.8<span style="color: #949494;">, </span>1.1<span style="color: #949494;">, </span>0.8<span style="color: #949494;">, </span>2.0<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ mspike               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8<span style="color: #949494;">, </span>1.3<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>1.4<span style="color: #949494;">, </span>0.5<span style="color: #949494;">, </span>1.2<span style="color: #949494;">, </span>0.5<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>0.0<span style="color: #949494;">, </span>0.0<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ age_group            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&lt;70"<span style="color: #949494;">, </span>"&lt;…</span></span>
<span><span class="co">#&gt; $ days_to_exit         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 19<span style="color: #949494;">, </span>43<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>46<span style="color: #949494;">, </span>40<span style="color: #949494;">, </span>41<span style="color: #949494;">, </span>22<span style="color: #949494;">, </span>31<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>57<span style="color: #949494;">, </span>52<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ status               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0…</span></span>
<span><span class="co">#&gt; $ time                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 19<span style="color: #949494;">, </span>43<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>46<span style="color: #949494;">, </span>40<span style="color: #949494;">, </span>41<span style="color: #949494;">, </span>22<span style="color: #949494;">, </span>31<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>57<span style="color: #949494;">, </span>52<span style="color: #949494;">,</span>…</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">mgus_diagnosis</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>       <span class="fu"><a href="../reference/addCohortSurvival.html">addCohortSurvival</a></span><span class="op">(</span></span>
<span>       cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>       outcomeCohortTable <span class="op">=</span> <span class="st">"death_cohort"</span>,</span>
<span>       outcomeDateVariable <span class="op">=</span> <span class="st">"cohort_end_date"</span>,</span>
<span>       censorOnDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1994-01-01"</span><span class="op">)</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort_start_date</span> <span class="op">&gt;</span> <span class="st">"1993-01-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 13</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.3.0 [unknown@Linux 6.11.0-1015-azure:R 4.5.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 213<span style="color: #949494;">, </span>671<span style="color: #949494;">, </span>941<span style="color: #949494;">, </span>1245<span style="color: #949494;">, </span>1248<span style="color: #949494;">, </span>1340<span style="color: #949494;">, </span>1374<span style="color: #949494;">, </span>1376<span style="color: #949494;">, </span>1380…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>1994-01-01<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ age                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 93<span style="color: #949494;">, </span>81<span style="color: #949494;">, </span>85<span style="color: #949494;">, </span>82<span style="color: #949494;">, </span>87<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>68<span style="color: #949494;">, </span>67<span style="color: #949494;">, </span>69<span style="color: #949494;">, </span>66<span style="color: #949494;">, </span>79<span style="color: #949494;">, </span>86<span style="color: #949494;">, </span>8…</span></span>
<span><span class="co">#&gt; $ sex                  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>M<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>F<span style="color: #949494;">, </span>M…</span></span>
<span><span class="co">#&gt; $ hgb                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 12.8<span style="color: #949494;">, </span>13.0<span style="color: #949494;">, </span>13.6<span style="color: #949494;">, </span>11.4<span style="color: #949494;">, </span>12.7<span style="color: #949494;">, </span>12.2<span style="color: #949494;">, </span>9.2<span style="color: #949494;">, </span>13.7<span style="color: #949494;">, </span>15…</span></span>
<span><span class="co">#&gt; $ creat                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.1<span style="color: #949494;">, </span>1.4<span style="color: #949494;">, </span>1.1<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>1.4<span style="color: #949494;">, </span>1.8<span style="color: #949494;">, </span>1.1<span style="color: #949494;">, </span>0.8<span style="color: #949494;">, </span>2.0<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ mspike               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8<span style="color: #949494;">, </span>1.3<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>1.4<span style="color: #949494;">, </span>0.5<span style="color: #949494;">, </span>1.2<span style="color: #949494;">, </span>0.5<span style="color: #949494;">, </span>1.5<span style="color: #949494;">, </span>0.0<span style="color: #949494;">, </span>0.0<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ age_group            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&gt;=70"<span style="color: #949494;">, </span>"&lt;70"<span style="color: #949494;">, </span>"&lt;…</span></span>
<span><span class="co">#&gt; $ days_to_exit         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0…</span></span>
<span><span class="co">#&gt; $ status               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0…</span></span>
<span><span class="co">#&gt; $ time                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0…</span></span></code></pre></div>
<p>This table with the added <code>time</code> and <code>status</code>
information should be enough to call any advanced function, like the
aforementioned Cox Proportional Hazards model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">input_survival_single</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; survival::coxph(formula = survival::Surv(time, status) ~ age + </span></span>
<span><span class="co">#&gt;     sex, data = input_survival_single)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          coef exp(coef) se(coef)      z        p</span></span>
<span><span class="co">#&gt; age  0.061622  1.063561 0.003402 18.114  &lt; 2e-16</span></span>
<span><span class="co">#&gt; sexM 0.358258  1.430835 0.065693  5.454 4.94e-08</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=391.2  on 2 df, p=&lt; 2.2e-16</span></span>
<span><span class="co">#&gt; n= 1384, number of events= 963</span></span>
<span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">input_survival_single</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; survival::survdiff(formula = survival::Surv(time, status) ~ sex, </span></span>
<span><span class="co">#&gt;     data = input_survival_single)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         N Observed Expected (O-E)^2/E (O-E)^2/V</span></span>
<span><span class="co">#&gt; sex=F 631      423      471      4.88      9.67</span></span>
<span><span class="co">#&gt; sex=M 753      540      492      4.67      9.67</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Chisq= 9.7  on 1 degrees of freedom, p= 0.002</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-analysis-with-competing-risk-survival">Further analysis with competing risk survival<a class="anchor" aria-label="anchor" href="#further-analysis-with-competing-risk-survival"></a>
</h2>
<p>For competing risk settings, we need to use the same function that
adds <code>time</code> and <code>status</code> information, but twice.
We first need to add time and status information for the outcome, then
for the competing outcome. Then we leverage all those variables to get
what outcome (if any) to count per individual so that we can feed the
result to subsequent models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Add all status and time information for both outcomes</span></span>
<span>  <span class="va">input_survival_cr</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">mgus_diagnosis</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/addCohortSurvival.html">addCohortSurvival</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="st">"progression"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>      <span class="st">"outcome_time"</span> <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>      <span class="st">"outcome_status"</span> <span class="op">=</span> <span class="st">"status"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>     <span class="fu"><a href="../reference/addCohortSurvival.html">addCohortSurvival</a></span><span class="op">(</span><span class="va">cdm</span>, <span class="st">"death_cohort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>      <span class="st">"competing_outcome_time"</span> <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>      <span class="st">"competing_outcome_status"</span> <span class="op">=</span> <span class="st">"status"</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Collect and </span></span>
<span>  <span class="va">input_survival_cr</span> <span class="op">&lt;-</span> <span class="va">input_survival_cr</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">outcome_time</span>, <span class="va">competing_outcome_time</span><span class="op">)</span>,</span>
<span>      status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">competing_outcome_time</span> <span class="op">&lt;=</span> <span class="va">outcome_time</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">competing_outcome_status</span>, <span class="va">outcome_status</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"outcome_time"</span>, <span class="st">"outcome_status"</span>, <span class="st">"competing_outcome_time"</span>, <span class="st">"competing_outcome_status"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can use the package <code>cmprsk</code> to fit a Fine and Gray
model to the competing risk data. We first change our <code>sex</code>
covariate to numeric, and then we can run the analysis:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_survival_cr</span> <span class="op">&lt;-</span> <span class="va">input_survival_cr</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"M"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">input_survival_cr</span><span class="op">$</span><span class="va">age</span>, <span class="va">input_survival_cr</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">cmprsk</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cmprsk/man/crr.html" class="external-link">crr</a></span><span class="op">(</span>ftime <span class="op">=</span> <span class="va">input_survival_cr</span><span class="op">$</span><span class="va">time</span>,</span>
<span>            fstatus <span class="op">=</span> <span class="va">input_survival_cr</span><span class="op">$</span><span class="va">status</span>,</span>
<span>            cov1 <span class="op">=</span> <span class="va">covs</span>,</span>
<span>            failcode <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            cencode <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Competing Risks Regression</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; cmprsk::crr(ftime = input_survival_cr$time, fstatus = input_survival_cr$status, </span></span>
<span><span class="co">#&gt;     cov1 = covs, failcode = 1, cencode = 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        coef exp(coef) se(coef)     z p-value</span></span>
<span><span class="co">#&gt; age -0.0192     0.981  0.00585 -3.28   0.001</span></span>
<span><span class="co">#&gt; sex  0.2871     1.333  0.19309  1.49   0.140</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     exp(coef) exp(-coef)  2.5% 97.5%</span></span>
<span><span class="co">#&gt; age     0.981       1.02 0.970 0.992</span></span>
<span><span class="co">#&gt; sex     1.333       0.75 0.913 1.945</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Num. cases = 1384</span></span>
<span><span class="co">#&gt; Pseudo Log-likelihood = -726 </span></span>
<span><span class="co">#&gt; Pseudo likelihood ratio test = 8.32  on 2 df,</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="disconnect-from-the-cdm-database-connection">Disconnect from the cdm database connection<a class="anchor" aria-label="anchor" href="#disconnect-from-the-cdm-database-connection"></a>
</h2>
<p>We finish by disconnecting from the cdm database connection.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/cdmDisconnect.html" class="external-link">cdmDisconnect</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kim López-Güell, Edward Burn, Marti Catala, Xintong Li, Danielle Newby, Nuria Mercade-Besora.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
